<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opera√ß√£o Caixa Preta</title>
  <style>
    :root{
      --accent:#21d07a; --accent-2:#00a86b; --bg-overlay: rgba(0,0,0,.55);
      --text:#e7f6ef; --muted:#a9c7b9; --ok:#5be37b; --err:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; color:var(--text); background:#0b1d1a; overflow:hidden }

    /* Fundo */
    .bg{ position:fixed; inset:0; z-index:-2; background:#000 url('assets/bg.jpg') center/cover no-repeat fixed; filter:saturate(1.05) contrast(1.05) }
    .bg::after{ content:""; position:absolute; inset:0; background:var(--bg-overlay) }

    /* Layout */
    .wrap{ height:100%; display:grid; grid-template-rows:auto 1fr auto }
    header{ padding:18px 22px; display:flex; align-items:center; gap:12px }
    header .badge{ background:rgba(0,0,0,.45); padding:6px 10px; border-radius:999px; font-size:.85rem; color:var(--muted) }
    header h1{ margin:0; font-size:1.25rem; text-shadow:0 3px 12px rgba(0,0,0,.5) }

    /* Palco: todos os cadeados espalhados */
    .stage{ position:relative; height:calc(100vh - 140px); overflow:hidden; }
    .lock-card{
      position:absolute; transform: translate(-50%, -50%);
      display:flex; flex-direction:column; align-items:center; gap:10px; text-align:center;
      padding:10px; background:transparent; border:none; box-shadow:none; 
      animation: pop 220ms ease-out;
    }
    @keyframes pop{ from{ transform:translate(-50%,-55%) scale(.95); opacity:0 } to{ transform:translate(-50%,-50%) scale(1); opacity:1 } }

    .title, .muted, .status { text-shadow:0 0 6px rgba(0,0,0,.8) }
    .title{ font-weight:600 }

    .row{ display:flex; gap:8px; align-items:center; width:min(420px,90vw) }
    input[type="text"]{
      flex:1; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.35); color:var(--text); font-size:1rem; outline:none
    }
    input[disabled]{ opacity:.6; cursor:not-allowed }
    button{
      padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.15);
      background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#062315; font-weight:700; cursor:pointer
    }
    button[disabled]{ opacity:.6; cursor:not-allowed }
    .status{ min-height:22px; font-size:.95rem }
    .ok{ color:var(--ok) } .err{ color:var(--err) }

    footer{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 22px }
    .progress{ display:flex; gap:8px; align-items:center }
    .dot{ width:14px; height:14px; border-radius:50%; border:2px solid #72f1b3aa; background:transparent }
    .dot.on{ background:var(--accent) }
    .reset{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,.18) }

    .help{ position:fixed; right:14px; bottom:84px; background:rgba(0,0,0,.6); color:var(--muted); padding:8px 12px; border-radius:12px; font-size:.85rem }
    @media (max-width:640px){ .help{ left:14px; right:auto; bottom:14px } }

    /* Modal final */
    .modal{ position:fixed; inset:0; display:none; place-items:center; backdrop-filter:blur(4px) }
    .modal.show{ display:grid }
    .modal .box{ background:#061914cc; color:var(--text); padding:28px; border-radius:16px; text-align:center; max-width:90% }

    /* Lock SVG beleza extra */
    .lock svg{ filter: drop-shadow(0 6px 18px rgba(0,0,0,.35)); }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="wrap">
    <header>
      <span class="badge">Jogo Sequencial</span>
      <h1>Opera√ß√£o Caixa Preta</h1>
    </header>

    <!-- todos os cadeados vis√≠veis e espalhados -->
    <main class="stage" id="stage"></main>

    <footer>
      <div class="progress" id="progress" aria-label="Progresso"></div>
      <button class="reset" id="btnReset" title="Reiniciar">Reiniciar</button>
    </footer>
  </div>

  <div class="help">Dica: as senhas seguem a ordem dos cadeados, um por vez.</div>

  <!-- Modal final -->
  <div class="modal" id="congrats">
    <div class="box">
      <h3>Parab√©ns, voc√™s conclu√≠ram o desafio üéâ</h3>
      <button id="closeModal">Fechar</button>
    </div>
  </div>

  <script>
    // Etapas e senhas (6 cadeados, √∫ltimo 4310)
    const LOCKS = [
      { id: 1, titulo: 'Cadeado 1', senha: 'GOLPE'   },
      { id: 2, titulo: 'Cadeado 2', senha: 'CEMCC'   },
      { id: 3, titulo: 'Cadeado 3', senha: 'DESVIO'  },
      { id: 4, titulo: 'Cadeado 4', senha: 'SUBORNO' },
      { id: 5, titulo: 'Cadeado 5', senha: '212'     },
      { id: 6, titulo: 'Cadeado 6', senha: '4310'    },
    ];

    const LS_KEY = 'cadeados-spread-v1';
    let state = JSON.parse(localStorage.getItem(LS_KEY) || '{"opened":{},"pos":{}}');
    const save = () => localStorage.setItem(LS_KEY, JSON.stringify(state));

    const normalize = v => (v||'').toString().trim().toUpperCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');

    const stage = document.getElementById('stage');
    const progress = document.getElementById('progress');
    const modal = document.getElementById('congrats');

    document.getElementById('btnReset').onclick = () => { state={opened:{}, pos:{}}; save(); render(); };
    document.getElementById('closeModal').onclick = () => modal.classList.remove('show');

    // Cadeado estiloso (gradiente + arco)
    function prettyLockSVG(style='closed'){
      const open = style === 'open';
      const active = style === 'active';
      // cores reativas
      const gradTop = active ? '#d6ffe9' : open ? '#bff5d7' : '#c8f1e0';
      const gradBot = active ? '#39d995' : open ? '#31c788' : '#34b184';
      const ringTop = '#ffffff', ringBot = '#dff1ea';
      const strokeBody = active ? '#0e4a36' : '#0b3b2d';

      return `
      <svg viewBox="0 0 64 80" width="150" height="180" role="img" aria-label="Cadeado" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="bodyGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="${gradTop}"/>
            <stop offset="100%" stop-color="${gradBot}"/>
          </linearGradient>
          <linearGradient id="ringGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="${ringTop}"/>
            <stop offset="100%" stop-color="${ringBot}"/>
          </linearGradient>
        </defs>
        ${open
          ? `<path d="M48 30 v-8 a16 16 0 0 0-32 0" fill="none" stroke="url(#ringGrad)" stroke-width="4" stroke-linecap="round"/>`
          : `<path d="M42 22 v-4 a16 16 0 0 0-32 0 v12" fill="none" stroke="url(#ringGrad)" stroke-width="4" stroke-linecap="round"/>`}
        <rect x="8" y="28" width="48" height="42" rx="10" fill="url(#bodyGrad)" stroke="${strokeBody}" stroke-width="2" />
        <circle cx="32" cy="46" r="4" fill="${strokeBody}"/>
      </svg>`;
    }

    // Gera posi√ß√µes "semi-fixas" (espalhadas) e guarda no localStorage
    function getPositionFor(id){
      if(state.pos[id]) return state.pos[id];
      // pontos ‚Äúseguros‚Äù (evita bordas/cabe√ßalho/rodap√©)
      const min = 12, max = 88;
      const triesMax = 40;
      let x, y, tries = 0;

      function isFarFromOthers(px,py){
        for(const k in state.pos){
          const [ox,oy] = state.pos[k];
          const dx = px-ox, dy = py-oy;
          const d = Math.sqrt(dx*dx + dy*dy);
          if(d < 18) return false; // distancia m√≠nima em porcentagem (tela)
        }
        return true;
      }

      do{
        x = Math.floor(min + Math.random()*(max-min));
        y = Math.floor(min + Math.random()*(max-min));
        tries++;
      } while(!isFarFromOthers(x,y) && tries<triesMax);

      state.pos[id] = [x,y];
      save();
      return state.pos[id];
    }

    function render(){
      stage.innerHTML = '';
      progress.innerHTML = '';

      // √≠ndice do pr√≥ximo a abrir
      const openedCount = LOCKS.filter(l => state.opened[l.id]).length;

      // progresso
      LOCKS.forEach((_, i) => {
        const d = document.createElement('div');
        d.className = 'dot' + (i < openedCount ? ' on' : '');
        progress.appendChild(d);
      });

      // terminou?
      if (openedCount >= LOCKS.length) { modal.classList.add('show'); return; }

      // cria todos os cadeados espalhados
      LOCKS.forEach((lock, idx) => {
        const opened = !!state.opened[lock.id];
        const active = idx === openedCount; // apenas o pr√≥ximo fica liberado

        const [px, py] = getPositionFor(lock.id);
        const card = document.createElement('section');
        card.className = 'lock-card';
        card.style.left = px + '%';
        card.style.top  = py + '%';

        // estilo do √≠cone conforme estado
        const iconStyle = opened ? 'open' : (active ? 'active' : 'closed');

        card.innerHTML = `
          <div class="lock">${prettyLockSVG(iconStyle)}</div>
          <div class="title">${lock.titulo}</div>
          <div class="muted" aria-live="polite">${opened ? 'Aberto!' : (active ? 'Ativo: digite a senha' : 'Bloqueado at√© abrir o anterior')}</div>
          <div class="row">
            <input ${opened || !active ? 'disabled' : ''} type="text" autocomplete="off" placeholder="Senha do ${idx+1}¬∫" aria-label="Senha do ${lock.titulo}">
            <button ${opened || !active ? 'disabled' : ''}>Abrir</button>
          </div>
          <div class="status"></div>
        `;

        const input = card.querySelector('input');
        const btn = card.querySelector('button');
        const status = card.querySelector('.status');

        function tryOpen(){
          if(!active || opened) return;
          const val = normalize(input.value);
          if(!val){ status.innerHTML = '<span class="err">Digite a senha.</span>'; return; }
          if(val === normalize(lock.senha)){
            state.opened[lock.id] = true; save();
            status.innerHTML = '<span class="ok">Cadeado aberto!</span>';
            // troca √≠cone para aberto e desabilita controles
            card.querySelector('.lock').innerHTML = prettyLockSVG('open');
            input.disabled = true; btn.disabled = true;
            // re-render geral para liberar o pr√≥ximo (mas mant√©m posi√ß√µes)
            setTimeout(render, 220);
          } else {
            status.innerHTML = '<span class="err">Senha incorreta.</span>';
          }
        }

        btn?.addEventListener('click', tryOpen);
        input?.addEventListener('keydown', e => { if(e.key === 'Enter') tryOpen(); });

        stage.appendChild(card);

        // foco autom√°tico no ativo
        if(active && input) setTimeout(()=>input.focus(), 0);
      });
    }

    render();
  </script>
</body>
</html>
